rm(list=ls()); graphics.off(); cat("\014")
source("test_problems.R")

folders = list.dirs("results",full.names=F )


for( folder in folders[-1] ) {
  
  files = list.files(paste0("results/",folder))
  files = sort(files)
  
  approach = character(length(files))
  y.vals = NULL
  
  
  clrs = rainbow(length(approach))
  
  
  Y.AVG = Y.SD = NULL
  
  for( i in 1:length(files) ) {

    appr = unlist(strsplit(files[i],"_",T))
    if( length(appr)>2 ) {
      approach[i] = paste0(appr[1],"_",appr[2])
    } else {
      approach[i] = appr[1]
    }
    
    res = readRDS(paste0("results/",folder,"/",files[i]))

    runs = max(res$run)
    n0 = length(which(res$af.info=="init"))/runs
    
    for( run in 1:runs ) {
      sols = cummin( c(min(res$y[which(res$run==run & res$af.info=="init")]),res$y[which(res$run==run & res$af.info!="init")]) )
      y.vals = rbind( y.vals, sols )
    }
    
    y.avg = apply(y.vals,2,mean)
    y.sd = apply(y.vals,2,sd)
    
    Y.AVG = rbind(Y.AVG,y.avg)
    Y.SD = rbind(Y.SD,y.sd)
    
    
  }
  
  UP = Y.AVG + Y.SD
  DW = Y.AVG - Y.SD
  
  f.star = actualOptimum(unlist(strsplit(folder,".",T))[1],d=ncol(res)-5)
  DW[which(DW<f.star)] = f.star
  
  for( i in 1:nrow(Y.AVG) ) {
    if( i==1 ) {
      plot( n0:(ncol(Y.AVG)+n0-1), Y.AVG[i,], type="o", pch=19, main=paste(folder),
            ylim=c(min(DW,f.star),max(UP)) )
    }
    polygon( c(n0:(ncol(Y.AVG)+n0-1),(ncol(Y.AVG)+n0-1):n0), c(UP[i,],rev(DW[i,])),
             col=adjustcolor(clrs[i],alpha.f=0.1), border=NA )   
  }
  
  for( i in 1:nrow(Y.AVG) )
    lines( n0:(ncol(Y.AVG)+n0-1), Y.AVG[i,], type="o", pch=19, lwd=3, col=clrs[i] )
  
  abline( h=f.star, lty=2 )
  legend("topright", legend=approach, col=clrs, lwd=2 )
 
}

